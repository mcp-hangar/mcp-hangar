# Provider with Secrets
# =====================
# This example shows how to use Kubernetes Secrets for sensitive configuration

apiVersion: mcp-hangar.io/v1alpha1
kind: MCPProvider
metadata:
  name: github-tools
  namespace: mcp-providers
  labels:
    app.kubernetes.io/name: github-tools
    mcp-hangar.io/category: devops
spec:
  mode: container
  image: ghcr.io/modelcontextprotocol/mcp-github:latest

  # Cold start - provider starts on first request
  replicas: 0

  # Environment variables from Secrets and ConfigMaps
  env:
    # From Secret
    - name: GITHUB_TOKEN
      valueFrom:
        secretKeyRef:
          name: github-credentials
          key: token

    # From ConfigMap
    - name: GITHUB_ORG
      valueFrom:
        configMapKeyRef:
          name: github-config
          key: organization

    # Literal value
    - name: LOG_LEVEL
      value: "info"

  # Rate limiting for API calls
  tools:
    allowList:
      - create_issue
      - list_issues
      - create_pull_request
      - list_pull_requests
    rateLimit:
      requestsPerMinute: 30
      burstSize: 10

  # Circuit breaker for API failures
  circuitBreaker:
    enabled: true
    failureThreshold: 5
    resetTimeout: "1m"

---
# Secret for GitHub token
apiVersion: v1
kind: Secret
metadata:
  name: github-credentials
  namespace: mcp-providers
type: Opaque
stringData:
  token: "ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"

---
# ConfigMap for configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: github-config
  namespace: mcp-providers
data:
  organization: "my-org"
